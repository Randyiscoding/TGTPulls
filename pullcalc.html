<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Priority Pull Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="default.css">

</head>
<body>
<button class="menu-button" onclick="toggleMenu()">â˜° Menu</button>

<div id="menuPanel" class="menu-panel">
    <a href="index.php">Priority Pull Calculator</a>
    <a href="barcodegenerator.html">Barcode Generator</a>
    <a>More Tools To Come</a>
</div>

<h1>Priority Pull Calculator</h1>

<div class="container">
    <label for="priority">Current Priority Count</label>
    <input type="number" id="priority" />

    <label for="priorityFilled">Priority Filled</label>
    <input type="number" id="priorityFilled" />

    <label for="goalPercentage">Goal Percentage (ex: 0.70)</label>
    <input type="number" step="0.01" id="goalPercentage" />

    <button onclick="calculate()">Calculate</button>

    <div id="results" class="result-box" style="display:none;">
        <p><b>Required Pulls:</b> <span id="basePulls"></span></p>
        <p><b>Adjusted for Guest Shopping:</b> <span id="bufferPulls"></span></p>
        <p><b>Staffing Recommendation:</b> <span id="staffRec"></span></p>
    </div>
</div>

<script>
function calculate() {
    // k = Hours since the store opened
    // g = Total priorities created per hour (since the store opened)
    // y = hours remaining in the workday
    // a = projected amount of priorities that will need to be pulled
    // tm = amount of projected time needed to pull remaining DPCIs
    // z = Number of Team members needed to pull the projected amount by store close
    // p = Priority (the number of DPCIs that need to be pulled [ref: myDay for info])
    // pf = Priority Filled (the number of DPCIs that have been pulled [ref: myDay for info])
    // goal or goalp = The percentage that is needed to meet metric (ref: ETL/SD for this number)
    // req = required pulls to get to goal
    // b = buffer amount to to pull so that you will still be at or close to goal 60 minutes after pulling

    const pullRate = 53.7887; // items Users are pulling per hour based on puling 28 items in 31Mins, 13secs, 56ms
    const p = parseFloat(document.getElementById("priority").value);
    const pf = parseFloat(document.getElementById("priorityFilled").value);
    const goal = parseFloat(document.getElementById("goalPercentage").value);
    let goalp = 0;

    if (isNaN(p) || isNaN(pf) || isNaN(goal)) {
        alert("Please enter all values.");
        return;
    }

    if (goal > 1){
        goalp = goal/100;
    } // Allows user to  enter whole number or Decimal numbers
    else{
    goalp = goal;
    }

    const storeOpen = "07:00:00"; //Assuming your store opens at 7pm Everyday
    const storeClose = "22:00:00"; //Assuming your store closes at 10pm Everyday

    // Current time
    const now = new Date();
    const nowStr = now.toTimeString().split(" ")[0];

    // Convert "HH:MM:SS" to Date objects for same day
    const today = new Date().toISOString().split("T")[0];
    const start = new Date(today + "T" + storeOpen);
    const end = new Date(today + "T" + storeClose);
    const current = new Date(today + "T" + nowStr);

    let k = (current - start) / (1000 * 60 * 60);
    let y = (end - current) / (1000 * 60 * 60);
    if (k < 0.5) k = 0.5; // prevent division explosion
    if (y >= 15) y = 15; // prevent division explosion Maybe??

    if (k <= 0 || y >= 15) {
       alert("Using This tool outside of Store hours may result in inaccurate Staffing Recommendations and Projected priorities");
    }

    //Math Area
    const req = (goalp * (p + pf)) - pf
    const g = (p+pf)/k
    const a = p+(g*y)
    const tm = (goalp*a)/pullRate
    const z = tm/y
    const d = g/pullRate
    const b = req/(1-goalp*d)



    document.getElementById("basePulls").innerText = Math.ceil(req);
    if (b < req){
    document.getElementById("bufferPulls").innerText = 0;
    }
    else{
        if(b > p){
        document.getElementById("bufferPulls").innerText = p;
        }
        else{document.getElementById("bufferPulls").innerText = Math.ceil(b);}
    }
    document.getElementById("staffRec").innerText = "We Recommend "+Math.round(z)+" TM(s) to pull based on a projected "+Math.ceil(a)+" over the next "+y.toFixed(2)+" hour(s)";
    document.getElementById("results").style.display = "block";
}
</script>
<script>
function toggleMenu() {
    const menu = document.getElementById("menuPanel");
    menu.style.display = (menu.style.display === "block") ? "none" : "block";
}
</script>
</body>
</html>
